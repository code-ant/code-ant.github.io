---
title: 什么是回源？CDN回源与域名回源各是什么？
date: 2020-02-03 17:48:38
categories: [网络,CDN]
tags: [CDN,回源,缓存,概念]
---

> 配置七牛云的时候，一直不是很清楚回源相关的概念，学习记录一下。

理解什么是回源之前，需要明白什么是CDN。

##### CDN

 全称:`Content Delivery Network或Content Ddistribute Network`，即内容分发网络 。其搭建的思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，尽量使内容传输的更快更稳定。<!--more-->CDN通过在网络边缘部署边缘服务器，依靠CDN中心平台的负载均衡、内容分发及调度等功能，使用户就近获取所需的内容，降低网络拥堵，提高用户访问响应速度和命中率。所以基本上CDN就是广泛采用各种缓存服务器，使得用户的请求直接由这些缓存服务器响应，加快了响应速度；只有在用户请求的资源在缓存服务器上没有找到或者请求访问的资源在源站点服务器上已经修改过的情况下，缓存服务器才会去访问源站点服务器以获取最新的资源。

简单来说，使用CDN的目的是使用户能够更快速、更稳定的获取网络内容。举个例子：京东自营的商品，拥有本地仓库，大多数能够在当日或者次日送达，相比单一发货地的网店快很多。众多本地仓库就是CDN，加快了货物的运送。

> 下图是一个CDN架构的基本原理图，实际使用中的架构会复杂得多，分级分区域等。

![CDN架构图]( http://images.wpt6.cn/cdn_overview.png )

##### 回源

什么是回源？客户端发送请求报文时，响应该请求报文的是源站点的服务器，而不是各节点上的缓存服务器，那么这个过程相对于通过各节点上的缓存服务器来响应的话就称作为回源。 

**什么情况下会回源？**

1. 用户访问时，如节点上无缓存，则会回源拉取资源
2. CDN 节点上的文件超时过期，会回源拉取资源
3. 若为不缓存文件，用户访问时，会直接回源
4. 未忽略 URL 参数域名，使用该形式域名带参数访问资源，会直接回源

**如何计算回源比？**

回源比分为回源请求数比例及回源流量比例两种

**回源请求数比：**统计数据来自所有边缘节点上的请求记录，其中，对于没有缓存或缓存过期（可缓存）的请求以及不可缓存的请求，均计入回源请求中，其他直接命中缓存的，则为命中请求。 

​		`回源请求数/（回源请求数+用户发送的请求数）` 

**回源流量比：**回源流量是回源请求文件大小产生的流量和请求本身产生的流量 

​		 `回源流量比=回源流量/回源流量+用户请求访问的流量`

**域名回源：** 在搜索引擎中所谓的 域名回源就是搜索引擎的蜘蛛在爬行的过程中直接抓取源地址上的内容而不是存在各个节点（CDN）上的缓存内容 



##### 参考图书与博客

-  CDN技术详解 
- [CDN技术详解-博客]( https://www.cnblogs.com/losbyday/p/5843960.html )
- [CDN工作原理]( https://segmentfault.com/a/1190000000538796 )
- [CDN多级缓存]( https://cloud.tencent.com/developer/article/1439913 )